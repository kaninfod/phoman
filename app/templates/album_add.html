{% extends "layout.html" %}

{% block content %}


<style type="text/css">

    .badge-danger {
      background-color: #d43f3a;
    }

    .badge-success {
      background-color: #6f841a;
    }

	.bs-example{
    	margin: 20px;
    }
</style>
<div class="row">
    <div id="image-list" class="col-lg-9">

    </div>

    <div class="col-lg-3">
        <div class="bs-example">

            {% for keyword in keywords %}
            <div class="dropdown">
                <a href="#" data-toggle="dropdown" class="dropdown-toggle">
                    <span id="{{ keyword[0] }}"
                        {% if keyword[0] in album.tags_include %}
                            include  class="badge badge-success"
                        {% elif  keyword[0] in album.tags_exclude%}
                            exclude  class="badge badge-danger"
                        {% else %}
                            class="badge"
                        {% endif %}
                        >{{ keyword[0] }}</span> </a>
                <ul class="dropdown-menu">
                    <li><a class="include-keyword">Include</a></li>
                    <li><a class="exclude-keyword">Exclude</a></li>
                </ul>
            </div>
            {% endfor %}
            <input id="submit" class="btn btn-default" type="submit" value="Submit">
        </div>
    </div>
</div>


<script type="text/javascript" language="javascript">

var album_id = "{{ album_id }}";

$(document).ready(function() {

$(".include-keyword").click(function() {

    parent_div = $(this).closest("div");

    badge = parent_div.find("a > span");
    badge.removeClass("badge-danger");
    badge.addClass("badge-success");
    badge.attr("include",'');

    include_menu = parent_div.find("ul > li > a").attr("id");

    if (album_id !== 'None') {
        submit_query()
    }

});

$(".exclude-keyword").click(function() {
    parent_div = $(this).closest("div");

    badge = parent_div.find("a > span");
    badge.removeClass("badge-success");
    badge.addClass("badge-danger");
    badge.attr("exclude",'');

    include_menu = parent_div.find("ul > li > a").attr("id");

    if (album_id !== 'None') {
        submit_query()
    }

  });

function submit_query() {

    outer_div = $(".bs-example");

    var excluded = [];
    outer_div.find('[exclude]').each(function(i) {
        excluded.push( $(this).attr("id") );
    });

    var included = [];
    outer_div.find('[include]').each(function(i) {
        included.push( $(this).attr("id") );
    });

    post_data = {'included':included, 'excluded':excluded};


    function url() {
        if (album_id !== 'None') {
            return "/album/new/" + album_id
        } else {
            return "/album/new"
        }
    }


    var request = $.ajax({
        type: 'POST',
        contentType: 'application/json',
        url: url(),
        data: JSON.stringify(post_data),
        dataType: 'html'

    })
     .done(function( html ) {
            get_images()
         });


}

    function get_images() {

        $.ajax({
            type: 'POST',
            contentType: 'application/json',
            url: "/album/save/" + album_id + "?ajax=1",
            dataType: 'json'
        })
         .done(function( html ) {
            $( "#image-list" ).html( html );
         });
    }


  if (album_id !== 'None') {
    get_images()
  } else {
    alert("no album_id")
  }




})

</script>



{% endblock %}